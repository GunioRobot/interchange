[set page_title][L]Preview[/L][/set]
[set ui_checklist]1[/set]
[set help_name]wizard.preview[/set]
@_UI_STD_HEAD_@

<p>

[L]To preview your site, click <b>Finish</b>. The following will occur[/L]:
<p>
<li>[L]A new online catalog will be created based on the configuration you have specified into the CommerceLauncher.[/L]
<li>[L]Your product data will be entered in the database.[/L]
<li>[L]Your content pages will be created.[/L]
<li>[L]The secure web server will be enabled (if selected, optional until launch.)[/L]
<li>[L]Sample customers and order data will be put in the database (if selected.)[/L]
<p>
[L WIZARD_STEP_PREVIEW_PAR_1]Please be patient after clicking the Finish button.
If you are uploading a large spreadsheet file, the server may take
several minutes to process your data.[/L]
<p>
[L WIZARD_STEP_PREVIEW_PAR_2]When you are satisfied with your catalog, click Launch to begin taking
orders.[/L] 
<p>
[L WIZARD_STEP_PREVIEW_PAR_3]In order to launch, you must have a secure (SSL) connection and payment
options selected.[/L]

<p>

[perl tables="transactions products"]
	my $pdb = $Db{products};
	my $tdb = $Db{transactions};
	my $pcount = $pdb->query( 
					{
						sql => 'select * from products',
						row_count => 1,
					}
					);
	my $tcount = $tdb->query( 
					{
						sql => 'select * from transactions',
						row_count => 1,
					}
					);
	delete $Scratch->{pmessage};
	delete $Scratch->{pdefault};
	if($pcount > 0) {
		$Scratch->{pmessage} = errmsg("%s products currently in the database - select Yes to add/replace products", $pcount);
		$Values->{sampleproducts} = $Scratch->{pdefault} = '';
		$Scratch->{pwidget} = "yesno";
	}
	else {
		$Scratch->{pmessage} = errmsg("No products currently in the database - select No to add no products");
		$Scratch->{pwidget} = "hidden";
		$Values->{sampleproducts} = $Scratch->{pdefault} = '1';
	}

	delete $Scratch->{tmessage};
	delete $Scratch->{tdefault};
	if($tcount > 0) {
		$Scratch->{tmessage} = errmsg("%s orders currently in the database - select Yes to add/replace orders", $tcount);
		$Values->{sampleorders} = $Scratch->{tdefault} = '';
	}
	else {
		$Scratch->{tmessage} = errmsg("No orders currently in the database - select No to leave blank");
		$Values->{sampleorders} = $Scratch->{tdefault} = '';
	}
	return;
[/perl]

[set write_flag]
	[flag type=write table="variable"]
	[flag type=write table="pricing"]
	[flag type=write table="products"]
[/set]

[comment]
When we get Postgres better figured out, we can put this back in for
it. Until then, MySQL and DBM only.
[/comment]

[if variable PGSQL]
	[tmp the_fields][L]sampleproducts buildcat enablesecure[/L][/tmp]
[else]
	[tmp the_fields][L]sampleproducts buildcat sampleorders enablesecure[/L][/tmp]
[/else]
[/if]

		
[table-editor 
	
	left_width=120
	table_width=500
	wizard=1
	defaults=1
	bottom_buttons=1
	next_text=[L]Finish[/L]
	no_top=1
	no_bottom=1
   	row_template="[scratch row_template]"

	mv_nextpage="[either][cgi ui_nextpage][or]__UI_BASE__/wizard/do_save[/either]"
	mv_prevpage="[either][cgi ui_prevpage][or]__UI_BASE__/wizard/step_products[/either]"
	hidden.ui_return_to="__UI_BASE__/wizard/index"
	hidden.mv_click="write_flag"
	hidden.mv_check=profile_save_values

	ui_wizard_fields="[scratch the_fields]"

	label.sampleorders="[L]Insert sample order data[/L]"
	help.sampleorders=`$Scratch->{tmessage}`
	widget.sampleorders=yesno

	label.buildcat="[L]Rebuild category lists[/L]"
	widget.buildcat=select
	passed.buildcat="[L]Yes[/L], [L]No[/L]"

	label.sampleproducts="[L]Insert products data[/L]"
	help.sampleproducts=`$Scratch->{pmessage}`
	widget.sampleproducts=`$Scratch->{pwidget}`

	label.enablesecure="[L]Enable Secure (SSL)[/L]"
	help.enablesecure="[L]Select Yes if your SSL secure server is set up[/L]"
	widget.enablesecure=yesno
]

@_UI_STD_FOOTER_@
