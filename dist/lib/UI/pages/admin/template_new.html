[set page_title]Template editor -- create new[/set]
[set ui_class]Content[/set]
[set help_name]page.main[/set]
[set icon_name]admin/icon_pages.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<form action="[area __UI_BASE__/template_create]" method=POST ENCTYPE="multipart/form-data">
<input type=hidden name=mv_action value=back>

[if scratch ui_error]
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1>
[scratch ui_error][set ui_error][/set]
</FONT>
</BLOCKQUOTE>
[/if]

<table border=0 __UI_T_PROPERTIES__>
<tr class=rborder>
<td colspan=2><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

[set Create new page]
[if !cgi ui_template_new]
mv_nextpage=@@MV_PAGE@@
[set ui_error]Need to select a file name.[/set]
mv_todo=return
[else]
mv_nextpage=__UI_BASE__/template_create
mv_todo=return
[/else]
[/if]
[/set]

[set Preview template]
mv_nextpage=__UI_BASE__/page_preview
mv_todo=return
[/set]


<tr class=ralt>
<td width=25%>
1. Choose a page template from the pull-down menu:

</td>
<td>
<select name="ui_template" size=1>
<option value=> Select a page template to base this on (optional)
[calc]
	@files = $Tag->list_glob('templates/*');
	for(@files) {
		next unless -f $_;
		my $name = $_;
		$data = $Tag->file($_);
		$name =~ s:.*/::;
		my $ref = {};
		$data =~ m{\[comment\]\s*(ui_.*?)\[/comment\]}s;
		my $structure = $1 || "ui_template_description: Unknown $name";
		my @lines = grep /\S/, split /\n/, $structure;
		for(@lines) {
			my ($el, $el_item, $el_data) = split /\s*:\s*/, $_;
			#Log ("found el=$el el_item=$el_item el_data=$el_data");
			if($el_data) {
				$ref->{$el} = { $el_item, $el_data };
			}
			else {
				$ref->{$el} = $el_item;
			}
		}
		#Log("ref is " . $Tag->uneval( { ref => $ref } ));
		push @out, qq{<OPTION VALUE="$_">$ref->{ui_template_description}};
	}
	return join "\n", @out;
[/calc]
</select>
</td>
</tr>
<tr id=rnorm>
<td>
2. (Optional) Preview your selection:
</td>
<td>
<input type="submit" name="mv_click" value="Preview template" onClick="this.form.target='_blank'"> &nbsp; (Opens a new window)
</td>
</tr>
<tr id=ralt>
<td>
3. Name the template you are creating:
</td>
<td>
<INPUT NAME=ui_template_new>
</td>
</tr>
<tr id=rnorm>
<td>
4. Upload a page to base it on:
</td>
<td>
<input type="file" name="ui_upload_template"><BR>
<span style="font-size: smaller; font-style: italic">
	You must have set up the page properly, with a
	&lt;!-- BEGIN CONTENT --&gt; and &lt;!-- END CONTENT --&gt; pair to
	delineate the top and bottom areas.</span>
</td>
</tr>

<tr id=ralt>
<td>
5. Click this button to create the template:
</td>
<td>
<input type="submit" name="mv_click" value="Create new page" onClick="this.form.target='_self'"> <INPUT TYPE=checkbox NAME=ui_show_template VALUE=1 CHECKED>Show template top/bottom<BR>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>


<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
