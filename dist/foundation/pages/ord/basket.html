[comment]
ui_template: Yes
ui_template_name: cart
[/comment]

[set page_title]__COMPANY__ -- Shopping Cart[/set]
[set page_banner]Shopping Cart Contents[/set]

[control reset=1]

[control-set]
[component]search_box_small[/component]
[/control-set]

[control-set]
[component]saved_carts_list_small[/component]
[/control-set]

[control-set]
[component]category_vertical[/component]
[/control-set]

[control-set]
[component]cart[/component]
[/control-set]

[control-set]
[component]random[/component]
[size]3[/size]
[cols]3[/cols]
[banner]See also[/banner]
[/control-set]

[control reset=1]

@_LEFTONLY_TOP_@

<!-- BEGIN CONTENT -->
<!-- placeholder -->
<!-- END CONTENT -->

[if session logged_in]
  [set Save Cart]
   mv_todo=return
   mv_nextpage=ord/basket
   [perl]
    my $nickname = $CGI->{c_nickname};
    my $lastupdate = $CGI->{c_updated};

    push(@Vend::TmpScratch,qw/just_nickname nickname/);

    $nickname =~ s/://g; $lastupdate =~ s/://g;
    $Scratch->{just_nickname} = $nickname;

    $Scratch->{nickname} = join(':',$nickname,$lastupdate);

    if($CGI->{save_cart} eq 'cart') {
        $Scratch->{nickname} .= ':c';
    } elsif($CGI->{save_cart} eq 'recurring') {
        $Scratch->{nickname} .= ':r';
    } else {
        $Scratch->{nickname} .= ':?';
    }

    delete($CGI->{save_cart});

    return '';
   [/perl]
   [userdb function=set_cart nickname="[scratch nickname]"]
  [/set]

  [if !scratch just_nickname]
    [tmp just_nickname][tag time]%b-%d-%Y[/tag][/tmp]
  [/if]

  [if cgi save_cart eq 'cart']
    <FORM ACTION="[process-target]" METHOD=POST>
    <FONT SIZE="-1">
    To save this cart, give it a nickname, then press 'Save Cart'.
    Nickname:
    <INPUT TYPE=TEXT NAME="c_nickname" SIZE=11 VALUE="[scratch just_nickname]">
    <INPUT TYPE=HIDDEN NAME="c_updated" VALUE="[tag time]%b %d[/tag]">
    <INPUT TYPE=HIDDEN NAME="save_cart" VALUE="cart">
    <INPUT TYPE=HIDDEN NAME="mv_todo" VALUE="return">
    <INPUT TYPE=HIDDEN NAME="mv_check" VALUE="Save Cart">
    <INPUT TYPE=SUBMIT VALUE="Save Cart">
    </FONT>
    </FORM>
  [elsif cgi save_cart eq 'recurring']
    <FORM ACTION="[process-target]" METHOD=POST>
    <FONT SIZE="-1">
    To save this recurring order, give it a nickname, then press 'Save Cart'.
    Nickname:
    <INPUT TYPE=TEXT NAME="c_nickname" SIZE=11 VALUE="[scratch just_nickname]">
    <INPUT TYPE=HIDDEN NAME="c_updated" VALUE="[tag time]%b %d[/tag]">
    <INPUT TYPE=HIDDEN NAME="save_cart" VALUE="recurring">
    <INPUT TYPE=HIDDEN NAME="mv_todo" VALUE="return">
    <INPUT TYPE=HIDDEN NAME="mv_check" VALUE="Save Cart">
    <INPUT TYPE=SUBMIT VALUE="Save Cart">
    </FONT>
    </FORM>
  [/elsif]
  [else]
    [page href="@@MV_PAGE@@" form="
        save_cart=cart
        mv_action=return
    "]Save Cart</A> &nbsp;
    [page href="@@MV_PAGE@@" form="
        save_cart=recurring
        mv_action=return
    "]Set as Recurring Order</A>
  [/else]
  [/if]
[/if]

@_LEFTONLY_BOTTOM_@
