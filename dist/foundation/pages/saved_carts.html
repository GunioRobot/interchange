[comment]
ui_template: Yes
ui_template_name: leftonly
[/comment]

[pragma strip_white]
[set page_title]__COMPANY__ -- Welcome[/set]
[set page_banner]Welcome[/set]
[set bgcolor]#FFFFFF[/set]

[control reset=1]

[control-set]
[component]search_box_small[/component]
[/control-set]

[control-set]
[component]cart_tiny[/component]
[/control-set]

[control-set]
[component]category_vertical[/component]
[/control-set]

[control reset=1]


[set members_only]1[/set]
[set page_banner]Saved Carts / Recurring Orders[/set]
[set page_title]__COMPANY__ -- Saved Carts / Recurring Orders[/set]

@_LEFTONLY_TOP_@

<!-- BEGIN CONTENT -->

[if cgi delete_cart]
  [userdb function=delete_cart nickname="[cgi delete_cart]"]
[/if]

[if cgi retrieve_cart]
  [userdb function=get_cart nickname="[cgi retrieve_cart]" merge=1 hide=1]
  [if cgi retrieve_cart =~ /:c$/]
    [userdb function=delete_cart nickname="[cgi retrieve_cart]"]
  [/if]
[/if]

[userdb function=get_cart_names hide=1]
[if value carts]
  [perl]
    $Scratch->{saved_carts_carts} = '';
    $Scratch->{saved_carts_recurring} = '';

    foreach my $var (split("\n",$Tag->value('carts'))) {
        my($name,$last_update,$type) = split(':',$var);

        my $delink = $Tag->page({
            href => "@@MV_PAGE@@",
            form => "
                delete_cart=$var
                mv_action=return
            ",
        });

        my $golink = $Tag->page({
            href => "@@MV_PAGE@@",
            form => "
                retrieve_cart=$var
                mv_action=return
            ",
        });

my $row = <<"END";
<tr class=cartrow>
<td valign=top class=cartrow>
  $delink<img src="@_UI_IMG_@admin/delsm.gif" border=0></a>&nbsp;&nbsp;
</td>
<td valign=top class=cartrow>$golink$name</A></td>
<td valign=top class=cartrow>$last_update</td>
</tr>
END

        if($type eq 'c') {
            $Scratch->{saved_carts_carts} .= $row;
        } elsif($type eq 'r') {
            $Scratch->{saved_carts_recurring} .= $row;
        }
    }

    return '';
  [/perl]
[/if]

<table border=1>
[loop list="saved_carts_carts saved_carts_recurring"]
[if scratch [loop-code]]
<tr>
   <td width="119" valign="top">
        <table width="102" border="1" cellspacing="0" cellpadding="0" bordercolor="__BARCONTRAST__">
        <tr><td>
        <table width="100" border="0" cellspacing="0" cellpadding="0">
        <tr>
        <td colspan=3 align=center>
        [if explicit]
          [condition]'[loop-code]' eq 'saved_carts_carts'[/condition]
          Saved Carts
        [/if]
        [if explicit]
          [condition]'[loop-code]' eq 'saved_carts_recurring'[/condition]
          Recurring Orders
        [/if]
        </td>
        </tr>
        <tr VALIGN=TOP class=cartalt>
                <td>&nbsp;</td>
                <td align=center width="67" class=cartalt>
                        Name
                </td>
                <td align=center width="33" class=cartalt>
                        Modified
                </td>
        </tr>
        [scratch [loop-code]]
        </table>
        </td></tr>
        </table>
 </td>
 </tr>
[/if]
[/loop]
</table>

<!-- END CONTENT -->

@_LEFTONLY_BOTTOM_@
